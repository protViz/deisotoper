#R

context("Test deisotoper")


test_that("test deisotoper::deisotoper", {
  dtoper <- deisotoper()
  x <-
    list(
      mZ = c(
        110.07172,
        111.07504,
        129.10249,
        130.08649,
        147.11302,
        149.04506,
        167.05571,
        175.11923,
        181.06099,
        199.07158,
        216.09814,
        223.15556,
        239.09503,
        251.15036,
        261.15579,
        262.13,
        280.14053,
        281.14398,
        285.00974,
        299.06165,
        303.02039,
        328.11386,
        332.20789,
        344.97641,
        345.14056,
        350.21866,
        355.06995,
        360.22412,
        368.17529,
        373.08078,
        415.03656,
        418.99521,
        430.2774,
        431.28107,
        464.26218,
        473.3085,
        476.18176,
        479.20718,
        481.25989,
        497.21811,
        521.27063,
        521.77087,
        540.7804,
        559.31946,
        560.32391,
        580.32739,
        582.30688,
        592.28766,
        592.35815,
        593.34113,
        608.25214,
        610.30243,
        610.36755,
        611.30554,
        611.37042,
        630.35724,
        631.36115,
        642.572,
        643.054,
        643.569,
        644.062,
        644.557,
        681.37762,
        684.31494,
        691.36011,
        709.37109,
        709.4353,
        710.44037,
        712.3092,
        721.33459,
        754.33899,
        774.36261,
        790.38892,
        791.39124,
        792.39221,
        813.4679,
        820.40479,
        823.41522,
        824.40546,
        825.39423,
        826.39734,
        840.47681,
        841.43036,
        841.47949,
        896.4137,
        903.47253,
        904.47565,
        905.47632,
        906.47607,
        924.46271,
        951.51038,
        969.52002,
        970.52283,
        1038.50195,
        1041.53308,
        1042.53845,
        1080.55493,
        1081.54773
      ),
      intensity = c(
        378322,
        32496.6,
        85689.6,
        46440.3,
        49645.2,
        25102.5,
        32516.2,
        83497.2,
        74653.1,
        37228,
        196053,
        83826.4,
        112718,
        114812,
        88089.5,
        61521.3,
        220054,
        58888.5,
        280334,
        122311,
        14953.2,
        26959.6,
        24854,
        27122.9,
        86216.1,
        63360.3,
        358968,
        47393.5,
        37893.2,
        16532.9,
        17259,
        37250.4,
        33679.8,
        21243.6,
        17854.9,
        51232.4,
        12738.8,
        19515.4,
        31560.1,
        48772.3,
        66481.2,
        23353.6,
        11994,
        15211,
        9883.29,
        14753.7,
        17304.7,
        51575.9,
        10917.6,
        40518.3,
        15107.3,
        62106.4,
        72496.1,
        9430.4,
        10289.3,
        34831.3,
        41981.1,
        17000,
        25000,
        12000,
        9000,
        4000,
        9579.9,
        10392.3,
        13507.4,
        38200.9,
        29990.5,
        9304.39,
        19849,
        10678.6,
        8452.85,
        14519.3,
        111717,
        185030,
        56020.8,
        3387.69,
        9478.08,
        7878.29,
        3167.8,
        20670.7,
        2774.25,
        31114.4,
        3385.92,
        4656.8,
        3687.15,
        65332.5,
        207097,
        68080.9,
        11934.3,
        3630.86,
        9201.02,
        47579.2,
        19125.8,
        3439.48,
        15082.1,
        8280.57,
        4170.47,
        2603.17
      ),
      title = "TP filtered inserted example 2 of protViz::deisotoper.",
      rtinseconds = 1581,
      charge = 2,
      scan = 1,
      id = 1,
      pepmass = 592.8093
    )
  
  xd <- deisotope(dtoper, x)
  
  xresult <-
    list(
      mZ = c(
        110.07172,
        129.10249,
        130.08649,
        147.11302,
        149.04506,
        167.05571,
        175.11923,
        181.06099,
        199.07158,
        216.09814,
        223.15556,
        239.09503,
        251.15036,
        261.15579,
        262.13,
        280.14053,
        285.00974,
        299.06165,
        303.02039,
        328.11386,
        332.20789,
        344.97641,
        345.14056,
        350.21866,
        355.06995,
        360.22412,
        368.17529,
        373.08078,
        415.03656,
        418.99521,
        430.2774,
        464.26218,
        473.3085,
        476.18176,
        479.20718,
        481.25989,
        497.21811,
        521.27063,
        540.7804,
        559.31946,
        580.32739,
        582.30688,
        592.28766,
        592.35815,
        593.34113,
        608.25214,
        610.30243,
        610.36755,
        611.30554,
        611.37042,
        630.35724,
        642.572,
        643.054,
        643.569,
        644.062,
        644.557,
        681.37762,
        684.31494,
        691.36011,
        709.37109,
        709.4353,
        712.3092,
        721.33459,
        754.33899,
        774.36261,
        790.38892,
        791.39124,
        813.4679,
        820.40479,
        823.41522,
        824.40546,
        825.39423,
        840.47681,
        841.43036,
        841.47949,
        896.4137,
        903.47253,
        904.47565,
        906.47607,
        924.46271,
        951.51038,
        969.52002,
        1038.50195,
        1041.53308,
        1080.55493,
        1081.54773
      ),
      intensity = c(
        410818.6,
        85689.6,
        46440.3,
        49645.2,
        25102.5,
        32516.2,
        83497.2,
        74653.1,
        37228,
        196053,
        83826.4,
        112718,
        114812,
        88089.5,
        61521.3,
        278942.5,
        280334,
        122311,
        14953.2,
        26959.6,
        24854,
        27122.9,
        86216.1,
        63360.3,
        358968,
        47393.5,
        37893.2,
        16532.9,
        17259,
        37250.4,
        54923.4,
        17854.9,
        51232.4,
        12738.8,
        19515.4,
        31560.1,
        48772.3,
        89834.8,
        11994,
        25094.29,
        14753.7,
        17304.7,
        51575.9,
        10917.6,
        40518.3,
        15107.3,
        62106.4,
        72496.1,
        9430.4,
        10289.3,
        76812.4,
        17000,
        25000,
        12000,
        9000,
        4000,
        9579.9,
        10392.3,
        13507.4,
        38200.9,
        39294.89,
        19849,
        10678.6,
        8452.85,
        14519.3,
        352767.8,
        241050.8,
        3387.69,
        9478.08,
        7878.29,
        3167.8,
        23444.95,
        31114.4,
        3385.92,
        4656.8,
        3687.15,
        340510.4,
        275177.9,
        11934.3,
        3630.86,
        9201.02,
        66705,
        3439.48,
        23362.67,
        4170.47,
        2603.17
      ),
      title = "TP filtered inserted example 2 of protViz::deisotoper.",
      rtinseconds = 1581,
      charge = 2,
      scan = 1,
      id = 1,
      pepmass = 592.8093
    )
  
  lapply(round(xd$mZ, 2) == round(xresult$mZ, 2) , expect_true)
  lapply(round(xd$intensity, 2)  == round(xresult$intensity, 2) ,
         expect_true)
})